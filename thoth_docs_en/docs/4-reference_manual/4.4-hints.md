# Hints

"Hints" are a fundamental element in the Thoth system to support the text-to-SQL conversion process. This document provides an overview of their purpose, usage and management within the framework.

## 1 - Introduction to Hints

Hints are texts stored in a vector database, composed of a single element: an explanatory text that clarifies complex terms or suggests non-intuitive interpretations. Their main objective is to facilitate the association between concepts expressed in a natural language question or request and the underlying database schema.

### 1.1 - Role in the Text-to-SQL Process

In the context of the Thoth system, every time a user asks a question, the SQL generation process includes a preliminary phase where hints "similar" or "relevant" to the request are extracted. These hints are then provided as additional context to the agent responsible for SQL generation, improving the precision and consistency of generated queries.

### 1.2 - Benefits of Hints

Hints help bridge the gap between natural language and the technical structure of a database. For example, they can explain how a common term used by the user translates into a specific column or table in the database, or provide suggestions on how to interpret an ambiguous request in a specific context.

## 2 - Hints Management

Hints management is a key process to ensure that the Thoth system can make the best use of this supporting information. Hints are created, loaded and updated through specific procedures integrated into the framework.

### 2.1 - Loading into Vector Database

Hints can be loaded into the vector database from a `dev.json` file, provided within the BIRD framework. This file contains a structured collection of data, including hints, which are processed and indexed in the vector database to allow rapid retrieval during the SQL generation process. This approach allows enriching the system with predefined context information, ready to be used in response to relevant questions.

### 2.2 - Creation and Update through Preprocessing

Hints can be generated or updated during Thoth system preprocessing phases. This process allows analyzing existing data or new inputs to create hints that better reflect database specificities or user needs. Through a dedicated interface, administrators can review and optimize hints to ensure they are always relevant and useful.

### 2.3 - User Interface for Management (CRUD)

Thoth offers a user interface (UI) for complete hints management, allowing creation, reading, updating and deletion (CRUD) operations. This interface allows authorized users to insert new hints, modify them based on feedback or changes in the database schema, and remove them if no longer needed, keeping the vector database always updated and functional.

## 3 - Practical Use of Hints

Hints find application in various scenarios within the Thoth system, improving interaction between users and databases.

### 3.1 - SQL Generation Support

As already mentioned, hints are used as additional context for the agent that generates SQL. When a question is asked, the system identifies the most relevant hints and integrates them into the process, helping to produce SQL queries that are more accurate and adherent to user intentions.

### 3.2 - Adaptation to Specific Databases

Hints can be customized to reflect the peculiarities of a specific database. This means that, even in the presence of complex schemas or unique terminologies, hints can guide the system in correctly translating user requests into executable queries.

## 4 - Conclusion

Hints represent an essential tool for improving the effectiveness of the text-to-SQL process in the Thoth system. By providing explanations and additional contexts, they allow a more precise translation of natural language requests into SQL queries, facilitating interaction with complex databases. Their management, through file loading, preprocessing and dedicated user interfaces, ensures that the system remains flexible and adaptable to user needs.

## 5 - Examples of Hints

Below are some examples of hints extracted from the `dev.json` file. These examples illustrate how hints help clarify complex concepts or suggest non-intuitive interpretations, facilitating the association between questions asked by users and the database schema.

### 5.1 - california_schools

- **Database ID**: california_schools
- **Question**: "What is the highest eligible free rate for K-12 students in the schools in Alameda County?"
- **Hint**: "Eligible free rate for K-12 = `Free Meal Count (K-12)` / `Enrollment (K-12)`"

- **Database ID**: california_schools
- **Question**: "Please list the zip code of all the charter schools in Fresno County Office of Education."
- **Hint**: "Charter schools refers to `Charter School (Y/N)` = 1 in the table fprm"

- **Database ID**: california_schools
- **Question**: "How many schools with an average score in Math greater than 400 in the SAT test are exclusively virtual?"
- **Hint**: "Exclusively virtual refers to Virtual = 'F'"

### 5.2 - financial

- **Database ID**: financial
- **Question**: "How many accounts who choose issuance after transaction are staying in East Bohemia region?"
- **Hint**: "A3 contains the data of region; 'POPLATEK PO OBRATU' represents for 'issuance after transaction'."

- **Database ID**: financial
- **Question**: "List out the account numbers of female clients who are oldest and has lowest average salary, calculate the gap between this lowest average salary with the highest average salary?"
- **Hint**: "Female means gender = 'F'; A11 refers to average salary; Gap = highest average salary - lowest average salary; If the person A's birthdate > B's birthdate, it means that person B is order than person A."

### 5.3 - toxicology

- **Database ID**: toxicology
- **Question**: "In the non-carcinogenic molecules, how many contain chlorine atoms?"
- **Hint**: "non-carcinogenic molecules refers to label = '-'; chlorine atoms refers to element = 'cl'"

- **Database ID**: toxicology
- **Question**: "What is the percentage of carbon in double-bond molecules?"
- **Hint**: "carbon refers to element = 'c'; double-bond molecules refers to bond_type = '='; percentage = DIVIDE(SUM(element = 'c'), COUNT(atom_id))"

### 5.4 - card_games

- **Database ID**: card_games
- **Question**: "What are the borderless cards available without powerful foils?"
- **Hint**: "borderless' refers to borderColor; poweful foils refers to cardKingdomFoilId paired with cardKingdomId AND cardKingdomId is not null"

- **Database ID**: card_games
- **Question**: "List all the mythic rarity print cards banned in gladiator format."
- **Hint**: "mythic rarity printing refers to rarity = 'mythic'; card banned refers to status = 'Banned'; in gladiator format refers to format = 'gladiator';"

### 5.5 - codebase_community

- **Database ID**: codebase_community
- **Question**: "Which user has a higher reputation, Harlan or Jarrod Dixon?"
- **Hint**: "\"Harlan\" and \"Jarrod Dixon\" are both DisplayName; highest reputation refers to Max(Reputation)"

- **Database ID**: codebase_community
- **Question**: "What is the display name of the user who is the owner of the most valuable post?"
- **Hint**: "most valuable post refers to Max(FavoriteCount)"

### 5.6 - superhero

- **Database ID**: superhero
- **Question**: "Please list all the superpowers of 3-D Man."
- **Hint**: "3-D Man refers to superhero_name = '3-D Man'; superpowers refers to power_name"

- **Database ID**: superhero
- **Question**: "How many superheroes have the super power of \"Super Strength\"?"
- **Hint**: "super power of \"Super Strength\" refers to power_name = 'Super Strength'"

### 5.7 - formula_1

- **Database ID**: formula_1
- **Question**: "Please list the reference names of the drivers who are eliminated in the first period in race number 20."
- **Hint**: "driver reference name refers to driverRef; first qualifying period refers to q1; drivers who are eliminated in the first qualifying period refers to 5 drivers with MAX(q1); race number refers to raceId;"

- **Database ID**: formula_1
- **Question**: "What is the surname of the driver with the best lap time in race number 19 in the second qualifying period?"
- **Hint**: "race number refers to raceId; second qualifying period refers to q2; best lap time refers to MIN(q2);"

### 5.8 - european_football_2

- **Database ID**: european_football_2
- **Question**: "Which player has the highest overall rating? Indicate the player's api id."
- **Hint**: "highest overall rating refers to MAX(overall_rating);"

- **Database ID**: european_football_2
- **Question**: "What is the height of the tallest player? Indicate his name."
- **Hint**: "tallest player refers to MAX(height);"

### 5.9 - trombosis_prediction

- **Database ID**: trombosis_prediction
- **Question**: "Are there more in-patient or outpatient who were male? What is the deviation in percentage?"
- **Hint**: "male refers to SEX = 'M'; in-patient refers to Admission = '+'; outpatient refers to Admission = '-'; percentage = DIVIDE(COUNT(ID) where SEX = 'M' and Admission = '+', COUNT(ID) where SEX = 'M' and Admission = '-')"

- **Database ID**: trombosis_prediction
- **Question**: "What is the percentage of female patient were born after 1930?"
- **Hint**: "female refers to Sex = 'F'; patient who were born after 1930 refers to year(Birthday) > '1930'; calculation = DIVIDE(COUNT(ID) where year(Birthday) > '1930' and SEX = 'F'), (COUNT(ID) where SEX = 'F')"

### 5.10 - student_club

- **Database ID**: student_club
- **Question**: "What's Angela Sanders's major?"
- **Hint**: "Angela Sanders is the full name; full name refers to first_name, last_name; major refers to major_name."

- **Database ID**: student_club
- **Question**: "How many students in the Student_Club are from the College of Engineering?"
- **Hint**: ""

### 5.11 - debit_card_specializing

- **Database ID**: debit_card_specializing
- **Question**: "How many gas stations in CZE has Premium gas?"
- **Hint**: ""

- **Database ID**: debit_card_specializing
- **Question**: "What is the ratio of customers who pay in EUR against customers who pay in CZK?"
- **Hint**: "ratio of customers who pay in EUR against customers who pay in CZK = count(Currency = 'EUR') / count(Currency = 'CZK')."