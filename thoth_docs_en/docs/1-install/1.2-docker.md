# Docker Installation

Docker installation is the recommended method for production deployment of ThothAI. The unified installation system provides automatic Docker orchestration with minimal manual configuration.

*[Image Placeholder: Docker installation overview diagram]*

!!! note "Docker Prerequisites"

    Ensure Docker and Docker Compose are installed on your system:
    - **Docker**: [Install Docker](https://docs.docker.com/get-docker/)
    - **Docker Compose**: Usually included with Docker Desktop
    
    Verify installation:
    ```bash
    docker --version
    docker compose version
    ```

## 1 - Unified Docker Installation

The main installation script provides fully automated Docker setup for both components.

### 1.1 - Running the Unified Installer

From the ThothAI project root directory:

```bash
./install.sh
```

*[Image Placeholder: Unified installer startup screen]*

### 1.2 - Installation Options

The installer supports various installation modes:

#### Interactive Mode (Default)
```bash
./install.sh
```
- Prompts for configuration choices
- Automatic Docker image building
- Auto-starts all services

*[Image Placeholder: Interactive installer menu]*

#### Non-Interactive Mode
```bash
# Install with default settings
./install.sh --auto

# Install specific databases
./install.sh --db postgresql,sqlite --auto

# Install specific vector databases  
./install.sh --vdb qdrant,chroma --auto

# Backend only
./install.sh --backend-only --auto

# Frontend only
./install.sh --frontend-only --auto
```

#### Manual Mode
```bash
./install.sh --manual
```
- Generates requirements and configurations
- Does not auto-start Docker containers
- Allows manual container management

*[Image Placeholder: Installation mode comparison]*

### 1.3 - Configuration During Installation

The installer will prompt for or auto-configure:

1. **Database Plugins**: PostgreSQL, MySQL, SQLite, Oracle, SQL Server, MariaDB, Supabase
2. **Vector Database Plugins**: Qdrant, Weaviate, Milvus, Chroma, PgVector, Pinecone  
3. **Environment Setup**: Virtual environment creation and dependency installation
4. **Docker Orchestration**: Automatic image building and container startup

*[Image Placeholder: Configuration selection screen]*

## 2 - Component-Specific Docker Installation

For targeted installations, you can install components individually.

### 2.1 - Backend Only Installation

```bash
cd thoth_be
./install.sh --auto
```

This installs:
- Django backend application
- PostgreSQL database
- Qdrant vector database
- Admin interface

*[Image Placeholder: Backend installation progress]*

### 2.2 - Frontend Only Installation

```bash
cd thoth_sl  
./install.sh --auto
```

This installs:
- Streamlit frontend application
- Required AI model dependencies
- Frontend-specific configurations

*[Image Placeholder: Frontend installation progress]*

## 3 - Environment Configuration

### 3.1 - Backend Environment Setup

The installer creates `thoth_be/_env` with required configurations:

```bash
# Django Configuration
SECRET_KEY=your_generated_secret_key
DJANGO_API_KEY=your_generated_api_key
DEBUG=False
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,thoth-be

# Database Configuration  
DATABASE_URL=postgresql://thoth_user:thoth_password@thoth-postgres:5432/thoth

# Vector Database
QDRANT_URL=http://thoth-qdrant:6333

# AI Provider Keys
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
OPENROUTER_API_KEY=your_openrouter_key

# Monitoring (Optional)
LOGFIRE_TOKEN=your_logfire_token
```

*[Image Placeholder: Environment file configuration]*

### 3.2 - Frontend Environment Setup

The installer creates `thoth_sl/_env` with frontend-specific settings:

```bash
# Backend Connection
DJANGO_SERVER=http://thoth-be:8000
DJANGO_API_KEY=your_generated_api_key

# AI Provider Keys (same as backend)
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
OPENROUTER_API_KEY=your_openrouter_key

# Local AI Services
OLLAMA_API_BASE=http://host.docker.internal:11434
LM_STUDIO_API_BASE=http://host.docker.internal:1234

# System Settings
DB_ROOT_PATH="/app/data"
TOKENIZERS_PARALLELISM=false
```

## 4 - Docker Compose Architecture

### 4.1 - Backend Services (thoth_be/docker-compose.yml)

```yaml
services:
  thoth-be:
    build: .
    ports:
      - "8040:8000"
    depends_on:
      - thoth-postgres
      - thoth-qdrant
      
  thoth-postgres:
    image: postgres:15
    ports:
      - "5443:5432"
      
  thoth-qdrant:
    image: qdrant/qdrant
    ports:
      - "6333:6333"
```

*[Image Placeholder: Backend Docker architecture diagram]*

### 4.2 - Frontend Services (thoth_sl/docker-compose.yml)

```yaml
services:
  thoth-sl:
    build: .
    ports:
      - "8501:8501"
    volumes:
      - ../thoth_be/data:/app/data
```

*[Image Placeholder: Frontend Docker architecture diagram]*

## 5 - Post-Installation Setup

### 5.1 - Verify Installation

Check that all services are running:

```bash
docker ps
```

Expected output:
```
CONTAINER ID   IMAGE              PORTS                    NAMES
abc123def456   thoth_be-thoth-be  0.0.0.0:8040->8000/tcp  thoth-be
def456ghi789   postgres:15        0.0.0.0:5443->5432/tcp  thoth-postgres  
ghi789jkl012   qdrant/qdrant     0.0.0.0:6333->6333/tcp  thoth-qdrant
jkl012mno345   thoth_sl-thoth-sl  0.0.0.0:8501->8501/tcp  thoth-sl
```

*[Image Placeholder: Docker ps output]*

### 5.2 - Initial Backend Configuration

Access the backend container and set up the database:

```bash
# Get backend container ID
docker ps | grep thoth-be

# Access container
docker exec -it <container-id> /bin/bash

# Create superuser
python manage.py createsuperuser

# Load default configuration
python manage.py load_defaults --source=docker
```

*[Image Placeholder: Backend setup commands in terminal]*

### 5.3 - Access Applications

After successful installation:

| Service | URL | Purpose |
|---------|-----|---------|
| **Backend** | http://localhost:8040 | Django admin and API |
| **Frontend** | http://localhost:8501 | Streamlit interface |
| **Admin Panel** | http://localhost:8040/admin | Backend administration |
| **Qdrant Dashboard** | http://localhost:6333/dashboard | Vector database management |

*[Image Placeholder: Application access URLs screenshot]*

## 6 - Docker Management Commands

### 6.1 - Service Management

```bash
# Start all services
docker compose up -d

# Stop all services  
docker compose down

# Rebuild and restart
docker compose up --build -d

# View logs
docker compose logs -f

# View specific service logs
docker compose logs thoth-be
```

### 6.2 - Data Management

```bash
# Backup database
docker exec thoth-postgres pg_dump -U thoth_user thoth > backup.sql

# Backup Qdrant data
docker exec thoth-qdrant tar -czf - /qdrant/storage > qdrant-backup.tar.gz
```

*[Image Placeholder: Docker management commands output]*

## 7 - Troubleshooting

### 7.1 - Common Issues

**Port conflicts:**
```bash
# Check port usage
netstat -tulpn | grep :8040

# Stop conflicting services
sudo systemctl stop apache2  # Example
```

**Container won't start:**
```bash
# Check logs
docker compose logs <service-name>

# Rebuild image
docker compose build --no-cache <service-name>
```

**Database connection issues:**
```bash
# Verify network connectivity
docker network ls
docker network inspect thoth_thotnet
```

*[Image Placeholder: Troubleshooting workflow diagram]*

### 7.2 - Verification Commands

```bash
# Test backend connectivity
curl http://localhost:8040/api/health/

# Test database connection
docker exec thoth-be python manage.py dbshell

# Test vector database
curl http://localhost:6333/collections
```

## Next Steps

After successful Docker installation:

1. **[Complete Quick Setup](1.4-quick_setup.md)** - Configure default workspace and users
2. **[Backend Configuration](../3-user_manual/3.1-setup/3.1.0-setup_process.md)** - Set up databases and AI models
3. **[Frontend Usage](../2-quickstart/2.1-quickstart_frontend.md)** - Start using the interface

*[Image Placeholder: Next steps workflow diagram]*