[supervisord]
nodaemon=true
user=root
logfile=/logs/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/logs/nginx.log
stderr_logfile=/logs/nginx.error.log
priority=10

[program:backend]
command=/app/backend/.venv/bin/gunicorn --bind 127.0.0.1:8000 --workers 4 --threads 2 --worker-class sync --timeout 120 --chdir /app/backend Thoth.wsgi:application
autostart=true
autorestart=true
stdout_logfile=/logs/backend.log
stderr_logfile=/logs/backend.error.log
environment=PATH="/app/backend/.venv/bin:%(ENV_PATH)s",PYTHONPATH="/app/backend"
priority=20
user=thoth

[program:frontend]
command=node /app/frontend/server.js
directory=/app/frontend
autostart=true
autorestart=true
stdout_logfile=/logs/frontend.log
stderr_logfile=/logs/frontend.error.log
environment=NODE_ENV="production",PORT="3000"
priority=30
user=thoth

[program:sql-generator]
command=/app/sql-generator/.venv/bin/python /app/sql-generator/run_server.py
directory=/app/sql-generator
autostart=true
autorestart=true
stdout_logfile=/logs/sql-generator.log
stderr_logfile=/logs/sql-generator.error.log
environment=PATH="/app/sql-generator/.venv/bin:%(ENV_PATH)s",PYTHONPATH="/app/sql-generator"
priority=40
user=thoth

[program:qdrant]
command=/usr/local/bin/qdrant --storage-path /data/qdrant
autostart=true
autorestart=true
stdout_logfile=/logs/qdrant.log
stderr_logfile=/logs/qdrant.error.log
priority=5
user=thoth

[program:cron]
command=cron -f
autostart=true
autorestart=true
stdout_logfile=/logs/cron.log
stderr_logfile=/logs/cron.error.log
priority=50

[group:thoth]
programs=nginx,backend,frontend,sql-generator,qdrant,cron