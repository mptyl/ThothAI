# SQL Display Bug Fix

## Identified Issue
The formatted SQL briefly appeared and then disappeared when the "Show SQL" flag was enabled.

## Root Cause
The AI message was rendered ONLY if it had textual content (`msg.content.trim()`) or was processing (`msg.isProcessing`).

When the backend sent only `SQL_FORMATTED` without other textual content, the message had:
- `content: ""` (empty)
- `formattedSql: "SELECT ..."` (present)
- `isProcessing: false`

The rendering condition at line 560 was:
```javascript
(msg.content.trim() || msg.isProcessing) ? (
```

This condition evaluated to `false` when the content was empty and not processing, so the entire AI message block was not rendered even though formatted SQL was available to display.

## Implemented Fix
Updated the rendering condition to also include messages that have formatted SQL or an explanation:

```javascript
(msg.content.trim() || msg.isProcessing || msg.formattedSql || msg.sqlExplanation) ? (
```

Now the AI message is rendered if it has at least one of:
- Textual content
- Is processing
- Formatted SQL
- SQL explanation

## Modified File
- `/app/chat/page.tsx` - Line 560

## Testing the Fix

1. Open http://localhost:3008
2. Enable "Show SQL" in the sidebar
3. Submit a question
4. The SQL should appear and remain visible
5. Toggling the flag should show/hide the SQL immediately
6. The explanation should continue working as before

## Result
✅ SQL now remains visible when the flag is enabled
✅ Flag toggling works correctly for both SQL and explanation
✅ Data is always generated by the backend regardless of flags
✅ The user has full control over the display
