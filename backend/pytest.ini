# Copyright (c) 2025 Marco Pancotti
# This file is part of Thoth and is released under the Apache License 2.0.
# See the LICENSE.md file in the project root for full license information.

[tool:pytest]
DJANGO_SETTINGS_MODULE = Thoth.settings
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test discovery paths
testpaths = tests

# Add project root to Python path
pythonpath = .

# Markers for different test types
markers =
    integration: Integration tests that use real services
    unit: Unit tests with mocked dependencies
    slow: Tests that take more than 5 seconds
    security: Security and authentication tests
    views: View and URL tests
    
# Coverage settings
addopts = 
    --strict-markers
    --tb=short
    --disable-warnings
    -p no:warnings
    --reuse-db
    --nomigrations
    --no-cov-on-fail

# Don't capture output by default (useful for debugging)
# Use -s flag to see print statements
capture = no

# Timeout for tests (seconds)
timeout = 300

# Environment variables for tests
env = 
    TESTING=True
    DJANGO_SETTINGS_MODULE=Thoth.settings
    
# Ignore these files/directories during test collection
norecursedirs = 
    .git
    .tox
    dist
    build
    *.egg
    venv
    migrations
    static
    media
    node_modules
    .vscode
    .idea
    htmlcov
    
# Console output settings
console_output_style = progress

# Show extra test summary info
# f = failed
# E = error
# s = skipped
# x = xfailed
# X = xpassed
# p = passed
# P = passed with output
# a = all except passed
tb = short

# Logging
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Test report generation
junit_family = xunit2
junit_suite_name = Thoth Test Suite
junit_logging = all
junit_log_passing_tests = true