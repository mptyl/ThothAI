{% extends "vertical_base.html" %}
{% load static %}

{% block title %}Evidence{% endblock title %}

{% block extra_css %}

<link href="{% static 'css/thoth/datatables.min.css' %}" rel="stylesheet"  type="text/css"/>
<link href="{% static 'css/vendor/responsive.bootstrap5.min.css' %}" rel="stylesheet" type="text/css" />

<style>
    /* Consistent row height styling to match questions table */
    #evidence-datatable th,
    #evidence-datatable td {
        vertical-align: middle;
        padding: 6px 8px;
        font-size: 0.875rem;
        line-height: 1.3;
    }
</style>

{% endblock %}

{% block page_title %}
{% include "partials/page-title.html" with page_title='Evidence' sub_title='Evidence & Context' %}
{% endblock %}

{% block content %}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-sm-5">
                        {% if user_is_editor %}
                        <a href="{% url 'thoth_ai_backend:create_evidence' %}" class="btn btn-danger mb-2"><i
                                class="mdi mdi-plus-circle me-2"></i>Add Evidence</a>
                        {% endif %}
                    </div>
                    <div class="col-sm-7">
                        <div class="text-sm-end">
                            {% if user_is_editor %}
                            <form method="POST" action="{% url 'thoth_ai_backend:delete_all_evidence' %}" style="display: inline-block; margin-right: 5px;" onsubmit="return confirm('Are you sure you want to delete ALL evidence? This action cannot be undone.');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger mb-2"><i class="mdi mdi-delete-sweep me-2"></i> Delete All Evidences</button>
                            </form>
                            <form method="POST" action="{% url 'thoth_ai_backend:import_evidence_server_csv' %}" style="display: inline-block; margin-right: 5px;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-info mb-2">Import from CSV</button>
                            </form>
                            {% endif %}
                            <a href="{% url 'thoth_ai_backend:export_evidence_csv' %}" class="btn btn-light mb-2">Export CSV</a>
                        </div>
                    </div><!-- end col-->
                </div>

                <div class="table-responsive">
                    <table id="evidence-datatable" class="table dt-responsive nowrap w-100 table-striped">
                        <thead>
                            <tr>
                                <th>Evidence</th>
                                {% if user_is_editor %}
                                <th class="action-column"  style="width: 85px;">Action</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for evidence_item in evidence_list %}
                            <tr>
                                <td>{{ evidence_item.evidence }}</td>
                                {% if user_is_editor %}
                                <td class="table-action">
                                    {# Link the edit icon to the update_evidence URL with the evidence's ID #}
                                    <a href="{% url 'thoth_ai_backend:update_evidence' evidence_id=evidence_item.id %}" class="action-icon"> <i
                                            class="mdi mdi-square-edit-outline"></i></a>
                                    {# Link the delete icon to the confirmation view #}
                                    <a href="{% url 'thoth_ai_backend:confirm_delete_evidence' evidence_id=evidence_item.id %}" class="action-icon"> <i
                                            class="mdi mdi-delete"></i></a>
                                </td>
                                {% endif %}
                            </tr>
                            {% empty %}
                            <tr>
                                <td>
                                    {% if error %}
                                        <div class="alert alert-error">
                                            {{ error }}
                                        </div>
                                    {% else %}
                                        No evidence found.
                                    {% endif %}
                                </td>
                                <td></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                 </div> <!-- end table-responsive-->
            </div> <!-- end card-body-->
        </div> <!-- end card-->
    </div> <!-- end col -->
</div>
<!-- end row -->

{% endblock %}

{% block extra_javascript %}

<!-- Third party js -->
<script src = "{% static 'js/thoth/datatables.min.js' %}"></script>
<!-- Third party js ends -->

<!-- Init js -->
<script src="{% static 'js/thoth/vdb.evidence.js' %}"></script>
<!-- Init js end -->

{% endblock %}
